# HTTP-Калькулятор математических выражений

### Описание

HTTP-сервер, который принимает математические выражения в формате JSON, вычисляет их и возвращает результат. Проект поддерживает базовые операции, скобки, валидацию входных данных и обработку ошибок.

### Возможности

- Выполнение базовых математических операций: `+`, `-`, `*`, `/`.
- Поддержка скобок для задания приоритетов.
- Работа с десятичными и отрицательными числами.
- Валидация входных данных и возвращение сообщений об ошибках.
- Логирование всех запросов и возникающих ошибок.

### Технологии

- **Go 1.23.0**
- **Стандартные библиотеки Go**
- **Testify: библиотека для модульного тестирования.**

### Структура проекта

```
├── cmd/
│   └── main.go             # Точка входа в приложение
├── internal/
│   ├── application/        # Основная логика приложения
│   │   ├── application.go  # HTTP-сервер и обработчики
│   │   ├── errors.go       # Определение ошибок для сервера
│   │   └── application_test.go  # Тесты приложения
│   └── calculation/        # Логика вычислений
│       ├── calculation.go  # Калькулятор
│       ├── errors.go       # Определение ошибок для калькулятора
│       └── calculation_test.go  # Тесты для калькулятора
└── go.mod                  # Зависимости проекта
```

### Установка и запуск

**1.Клонируйте репозиторий:**
```
git clone https://github.com/flexer2006/y.lms_sprint1_Calc.git
```

**2.Перейдите в директорию проекта:**
```
cd y.lms_sprint1_Calc
```

**3.Запустите сервер:**
```
go run cmd/main.go
```

Сервер по умолчанию запускается на порту `8080`. Чтобы указать другой порт, задайте переменную окружения `PORT`:
```
PORT=9090 go run cmd/main.go
```

### Вычисление выражения

**Правильный запрос:**
```
POST /calculate
Content-Type: application/json
{
  "expression": "2 + 2"
}
```

**Ответ при успешном вычислении:**
```
{
  "result": 4
}
```

**Неправильный запрос:**
```
POST /calculate
Content-Type: application/json
{
  "expression": "2 / 0"
}
```

**Ответ с ошибкой:**
```
{

    "error": {

        "error": "Division by Zero",

        "code": 422,

        "description": "Cannot divide by zero"

    }

}
```

### Поддерживаемые операции

- **Сложение (`+`)**
- **Вычитание (`-`)**
- **Умножение (`*`)**
- **Деление (`/`)**
- **Скобки (`()`)**
- **Унарный минус (`-5`, `-(2 + 3)`)**

*Десятичные числа используются через точку*

### Обработка ошибок

**Коды ошибок и их описание:**

- **Код 200 OK** указывает на то, что запрос выполнен успешно.
- **400 Bad Request**: некорректный формат JSON, пустое или неверное выражение, использование недопустимых символов, несогласованные скобки.
- **405 Method Not Allowed**: использование неподдерживаемого HTTP-метода.
- **422 Unprocessable Entity**: ошибка вычислений (например, деление на ноль).
- **500 Internal Server Error**: внутренняя ошибка сервера.

### Примеры использования

**Простое выражение:**
```
curl -X POST http://localhost:8080/calculate -H "Content-Type: application/json" -d "{\"expression\": \"2 + 2\"}"
```

**Сложное выражение:**
```
curl -X POST http://localhost:8080/calculate -H "Content-Type: application/json" -d "{\"expression\": \"(2 + 3) * 4\"}"
```

**Работа с десятичными числами:**
```
curl -X POST http://localhost:8080/calculate -H "Content-Type: application/json" -d "{\"expression\": \"1.5 * -2.5\"}"
```

### Тестирование

**Также добавлены go_тесты для application.go и calculation.go:**
- Базовые тесты: Проверяют корректность выполнения основных операций калькулятора.
- Тесты на граничные случаи: Проверяет корректность выполнения при некорректных входных данных.
- Тесты HTTP: Проверяет корректность обработки HTTP-запросов.
- Тесты middleware: Проверяют корректность работы логирования запросов.
- Тесты на скорость работы: Проверяют работу калькулятора с большими числами и длинными выражениями.

**Для запуска тестов выполните:**
```
go test ./...
```

**Для подробного вывода тестов:**
```
go test ./... -v
```

### Логирование

**Все запросы и ошибки логируются в формате:**
```
[CALC] YYYY/MM/DD HH:MM:SS file.go:XX Request: Method=POST Path=/calculate RemoteAddr=192.168.X.X
```

**Логи можно перенаправить в файл при запуске приложения:**
```
go run cmd/main.go > app.log
```
